<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="bower_components/Materialize/dist/css/materialize.min.css" media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="bower_components/jquery-ui/themes/smoothness/jquery-ui.min.css">
    <link type="text/css" rel="stylesheet" href="bower_components/EasyAutocomplete/dist/easy-autocomplete.css"/>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
	<main>
		<div class="blue darken-1">
			<div id="input-block" class="container">
				<div id="navigation-container">
					<ul class="tabs">
						<li id="tab-main" class="tab col s6 active"><a href="">Main</a></li>
						<li id="tab-about" class="tab col s6"><a href="">About</a></li>
					</ul>
				</div>

				<div id="page-title" class="hide-on-med-and-down">
					<p id="title" class="white-text">LIBRARY METHODS COUNT</p>
					<p id="subtitle" class="white-text"><i>Your solution for a perfectly fit APK</i></p>
				</div>
			</div>
		</div>

		<div class="blue darken-1">
			<div id="input-content" class="container">
				<form id="search-form" action="" onsubmit="return false;" method="POST">
					<div class="input-field hoverable">
						<input id="search-box" type="text" class="white validate" type="submit"
						placeholder="Insert the library 'compile' statement (e.g., com.google.code.gson:gson:2.4)" 
						data-position="bottom" data-validation="custom" 
						data-validation-error-msg="This looks invalid! Please stick to group_id:artifact_id:version ('+' is supported)" 
						data-validation-error-msg-container="#fuck" data-validation-regexp="^([a-zA-Z\d\.\-]+:[a-zA-Z\d\.\-]+:[\d\.@\+]+)$" />
						<a id="search-button" href="#" class="material-icons material-icons">search</a>
					</div>
				</form>
			</div>
		</div>
		<div id="shadow-container" class="blue darken-1 z-depth-1"></div>

		<div id="main-container" class="container">
			<div id="welcome-card-container" class="card-container">
				<div id="welcome-card" class="card hoverable">
		        	<div class="card-content">
		          		<span class="card-title grey-text text-darken-3">Library methods count</span>
		          			<p>Android libraries are great, but they come at a cost. Use this tool to avoid the dreaded 65K method limit of the DEX file format!</p>
		        	</div>
		        	<div class="card-action">
		          		<a id="try-now" class="pink-text text-darken-1" href="#">Try now</a>
		        	</div>
		      	</div>
	      	</div>

	      	<div id="progress-container" class="container">
	      		<div>
	      			<p id="progress-message"></p>
	      		</div>
		      	<div id="progress" class="progress">
		      		<div class="indeterminate"></div>
		  		</div>
	  		</div>

			<div id="result-card-container" class="card-container">
				<div id="result-card" class="card hoverable">
		        	<div>
		        		<p class="grey-text text-darken-1 result-card-header">Library name</p>
		        	</div>
		        	<div>
		        		<p id="result-lib-name" class="indent-right">com.github.dextorer:sofa:1.0.0&nbsp;</p>
		        	</div>
		        	<hr/>
		        	<div>
		        		<table id="result-library-stats">
		        			<th class="grey-text text-darken-1 result-card-header">Methods count</th>
		        			<th class="grey-text text-darken-1 result-card-header">Dependencies</th>
		        			<th class="grey-text text-darken-1 result-card-header">Size (KB)</th>
		        			<tbody>
			        			<tr>
			        				<td>817</td>
			        				<td>4</td>
			        				<td>103622</td>
			        			</tr>
		        			</tbody>
		        		</table>
		        	</div>
		        	<div id="result-dep-summary-container">
		        		<hr/>
		        		<table id="result-dependency-summary">
		        			<th class="grey-text text-darken-1 result-card-header">Dependencies methods count</th>
		        			<th class="grey-text text-darken-1 result-card-header">Dependencies size (KB)</th>
		        			<tbody>
		        				<tr>
		        					<td>123456</td>
		        					<td>999999</td>
		   						</tr>
		        		</table>
		        		<hr/>
		        	</div>
		        	<div id="result-card-dep-container">
			        	<div>
			        		<p id="result-card-dep-list-title" class="grey-text text-darken-1 result-card-header">Dependency list <i>(click to expand)</i></p>
			        	</div>
			        	<div class="indent-right">
			        		<ul id="result-card-dep-list">
			        			<li>
				        			<div>
				        				<p>com.android.support:leanback-v17:22.2.0</p>
				        				<div class="indent-right">
					        				<blockquote>
					        					<p>Methods count: 5223</p>
					        					<p>Library size: 64 KB</p>
					        				</blockquote>
				        				</div>
				        			</div>
			        			</li>
			        		</ul>
			        	</div>
		        	</div>
		      	</div>
	      	</div>

	      	<div id="error-card-container" class="card-container">
				<div id="error-card" class="card hoverable">
		        	<div class="card-content">
		          		<span class="card-title grey-text text-darken-3">Wait, what?</span>
		          			<p>An error has occurred while retrieving the information on this library. Please try again or contact me!</p>
		        	</div>
		        	<div class="card-action">
		          		<a href="">Ping me</a>
		        	</div>
		      	</div>
	      	</div>
      	</div>

      	<div id="about-container" class="container card-container">
      		<div id="about-card" class="card">
      			<h5>On Android and DEX</h5>
	      			<p class="flow-text about-paragraph">Developing Android apps has become easier and easier thoughout the years, in particular as more developers jumped onboard and started crafting <b>libraries for the community</b>. Everything, from asynchronously loading images to parsing JSON, is now more straightforward than ever, thanks to the likes of Picasso, Gson and thousands more. And let's not forget about supporting older Android versions, too! Google provides us <b>"support libraries"</b> that we use, for instance, to bring Material Design goodness to everything that came before Lollipop. It's all a matter of adding a 'compile' statement to our Gradle build file and we are good to go. Thanks, progress!</p>
	      			
	      			<p class="flow-text about-paragraph">However, as you may or may not are (though you should be) aware, <b>there is a limit to the methods that your app can reference</b>, and that limit amounts to 65536. More specifically, this limit is found inside the header of the DEX file, which contains all the compiled Java classes required by our app. It may seem like a lot of room for one app, but if you start considering that the most popular libraries contain thousands of methods each, that limit will look tremendously nearer to you.</p>
	      			
	      			<p class="flow-text about-paragraph">This issue has grown bigger and bigger, and big companies were usually the first to trip into this obstacle, having to resort to hacky workarounds (e.g. loading a secondary DEX at runtime, or using ProGuard/DexGuard to strip the libraries from unused methods). But there was no official way of addressing the problem, especially from Google. Until Lollipop, of course. <b>Enter MultiDex.</b></p>
	      			
	      		<br/>
      			<h5>MultiDex to the rescue!</h5>
      				<p class="flow-text about-paragraph">Starting from Lollipop, we have <b>a new runtime called ART</b> (<b>A</b>ndroid <b>R</b>un<b>T</b>ime). Among the greatest advantages that it brought, we find the ability of <b>loading multiple DEX files</b> for a single app. By explicitely declaring the use of MultiDex programmatically, the build system takes care of creating multiple DEXs and bundling them into the final APK. Thanks to ART, the DEXs are then assembled back and converted to another file (an OAT file), which will then be loaded when the user opens the app.</p>

      				<p class="flow-text about-paragraph">But what about <b>Android versions prior to Lollipop</b>? Since they still run on the Dalvik runtime, a different approach had to be taken. In this case, DEXs are loaded at runtime by patching the class loader. However, this technique is a little "hacky", and thus is not guaranteed to work across all the previous Android versions. For this reasons, big companies are still likely to rely on their custom-made solutions.</p>
      			
      				<p class="flow-text about-paragraph">Even though MultiDex offers a way out, the recommended approach is still the following:
      					<blockquote style="font-size: 20px;"><i>Stay below the limit, as much as you can.</i></blockquote>

      			<br/>
      			<h5>Staying below the limit (or, what this is all about)</h5>
      				<p class="flow-text about-paragraph">This service should help you dealing with the issue of the methods limit. By checking how many methods a library contains, you can determine if it fits in your app or not, before experiencing the dreadful experience of not being able to build anymore. In addition, you are able to check what dependencies does the library rely on, and how many methods do they contain as well.</p>

      				<blockquote>
      				<p class="flow-text about-paragraph"><b>DISCLAIMER</b></p>
      				<p class="flow-text about-paragraph">The methods count is read directly from the DEX header file and is meant to be an <b>UPPER BOUND</b> to what will end up in the final APK. Be aware that there are techniques, such as ProGuard's stripping, that can reduce the overall methods number and library size (drastically, in some cases).</p>
      				</blockquote>
      			
				<br/>
      			<h5>What libraries are supported?</h5>
      				<p class="flow-text about-paragraph">Every Android/Java library that you can find the Gradle 'compile' statement for. However, these are the repositories that are currently included in the process:</p>
      				<ul class="flow-text about-paragraph">
      					<li>Maven Central</li>
      					<li>jCenter</li>
      					<li>JitPack</li>
      				</ul>
      				<p class="flow-text about-paragraph">Know another one that I should add? Be sure to let me know!</p>

      			<br/>
      			<h5>Why so <strike>serious</strike> slow?</h5>
      				<p class="flow-text about-paragraph">Because the library you have requested has not been computed yet. The computation of a library involves fetching the library, DEXing it and retrieving the method number and the size. For large libraries, <b>this can take quite a long time</b> (even minutes). However, the more libraries are added to the system, the less chances are that you will ask for a library that has not been processed yet.</p>
      			
      			<br/>
      			<h5>What's next?</h5>
      				<p class="flow-text about-paragraph">This is the initial version of the service, and is therefore barely functional. First of all, I will try to make it as stable and responsive as possible. A thing that I have planned for the near future is adding a chart for each library, that shows <b>the trend on the methods count and the size</b>. I believe it's going to be extremely interesting, and it will perhaps instill some awareness to developers that recklessly include huge libraries without seeking for alternatives first.</p>

  				<br/>
      			<h5>Can I help?</h5>
      				<p class="flow-text about-paragraph">Sure! I'm extremely open to suggestions and improvements. Be sure to contact me via the social channels that you find at the bottom of this page. And in the meantime, thank you! :-)</p>
      		</div>
      	</div>
	</main>

	<script type="text/javascript" src="bower_components/jquery/dist/jquery.js"></script>
	<script type="text/javascript" src="bower_components/jquery-ui/jquery-ui.js"></script>
	<script type="text/javascript" src="bower_components/EasyAutocomplete/dist/jquery.easy-autocomplete.js"></script> 
	<script type="text/javascript" src="bower_components/Materialize/dist/js/materialize.js"></script>
	<script type="text/javascript" src="bower_components/jquery-form-validator/form-validator/jquery.form-validator.js"></script>
	<script type="text/javascript" src="api.js"></script>

</body>

<footer class="page-footer blue darken-1">
	<div class="footer-copyright">
    	<div class="container">
    		&copy; 2015 Sebastiano Gottardo
    	</div>
  	</div>
</footer>
